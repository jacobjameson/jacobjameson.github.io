<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.433">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Jacob Jameson">
<meta name="dcterms.date" content="2024-03-26">
<meta name="description" content="Embarking on a DIY Journey with Machine Learning Algorithms.">

<title>Jacob Jameson - DIY Decision Trees</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<meta name="twitter:title" content="Jacob Jameson - DIY Decision Trees">
<meta name="twitter:description" content="Embarking on a DIY Journey with Machine Learning Algorithms.">
<meta name="twitter:image" content="https://www.jacobjameson.com/posts/2024-03-26-DT/images/profile.png">
<meta name="twitter:creator" content="@JacobCJameson">
<meta name="twitter:card" content="summary_large_image">
</head>

<body class="floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a href="../../index.html" class="navbar-brand navbar-brand-logo">
    <img src="../../images/sig.png" alt="" class="navbar-logo">
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://www.linkedin.com/in/jacob-jameson" rel="" target="_blank"><i class="bi bi-linkedin" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/JacobCJameson" rel="" target="_blank"><i class="bi bi-twitter" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/jacobjameson" rel="" target="_blank"><i class="bi bi-github" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../posts/blog.html" rel="" target="">
 <span class="menu-text">Blog</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-teaching" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
 <span class="menu-text">Teaching</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-teaching">    
        <li>
    <a class="dropdown-item" href="../../teaching.html" rel="" target="">
 <span class="dropdown-text">Jacobâ€™s Teaching Experience</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../R files/Intro R.html" rel="" target="">
 <span class="dropdown-text">Introduction to R</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../git files/Intro Git.html" rel="" target="">
 <span class="dropdown-text">Introduction to Git/GitHub</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../api 222 files/API222.html" rel="" target="">
 <span class="dropdown-text">API 222 Section Material</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="../../research.html" rel="" target="">
 <span class="menu-text">Research</span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-full page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
    <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#decision-trees" id="toc-decision-trees" class="nav-link active" data-scroll-target="#decision-trees">Decision Trees</a>
  <ul class="collapse">
  <li><a href="#embarking-on-a-diy-journey-with-machine-learning-algorithms" id="toc-embarking-on-a-diy-journey-with-machine-learning-algorithms" class="nav-link" data-scroll-target="#embarking-on-a-diy-journey-with-machine-learning-algorithms">Embarking on a DIY Journey with Machine Learning Algorithms</a></li>
  <li><a href="#practical-benefits-of-a-hands-on-approach" id="toc-practical-benefits-of-a-hands-on-approach" class="nav-link" data-scroll-target="#practical-benefits-of-a-hands-on-approach">Practical Benefits of a Hands-On Approach</a></li>
  <li><a href="#metrics-the-compass-for-improvement" id="toc-metrics-the-compass-for-improvement" class="nav-link" data-scroll-target="#metrics-the-compass-for-improvement">Metrics: The Compass for Improvement</a></li>
  </ul></li>
  <li><a href="#building-our-decision-tree" id="toc-building-our-decision-tree" class="nav-link" data-scroll-target="#building-our-decision-tree">Building our Decision Tree</a>
  <ul class="collapse">
  <li><a href="#comparing-our-tree-to-rpart" id="toc-comparing-our-tree-to-rpart" class="nav-link" data-scroll-target="#comparing-our-tree-to-rpart">Comparing Our Tree to <code>rpart</code></a></li>
  <li><a href="#building-the-tree-with-rpart" id="toc-building-the-tree-with-rpart" class="nav-link" data-scroll-target="#building-the-tree-with-rpart">Building the Tree with <code>rpart</code></a>
  <ul class="collapse">
  <li><a href="#visualizing-the-rpart-tree" id="toc-visualizing-the-rpart-tree" class="nav-link" data-scroll-target="#visualizing-the-rpart-tree">Visualizing the rpart Tree</a></li>
  </ul></li>
  <li><a href="#evaluating-the-models" id="toc-evaluating-the-models" class="nav-link" data-scroll-target="#evaluating-the-models">Evaluating the Models</a></li>
  <li><a href="#conclusion" id="toc-conclusion" class="nav-link" data-scroll-target="#conclusion">Conclusion</a></li>
  </ul></li>
  </ul>
</nav>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar zindex-bottom">
    </div>
<!-- main -->
<main class="content column-page-right" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">DIY Decision Trees</h1>
  <div class="quarto-categories">
    <div class="quarto-category">decison trees</div>
    <div class="quarto-category">machine learning</div>
  </div>
  </div>

<div>
  <div class="description">
    Embarking on a DIY Journey with Machine Learning Algorithms.
  </div>
</div>


<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Jacob Jameson </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">March 26, 2024</p>
    </div>
  </div>
  
    
  </div>
  

</header>

<section id="decision-trees" class="level1">
<h1>Decision Trees</h1>
<p>Decision trees are a fundamental machine learning algorithm thatâ€™s easy to understand and interpret. Theyâ€™re a popular choice for classification and regression tasks, offering a visual representation of the decision-making process. In this series, weâ€™ll explore the inner workings of decision trees, starting with the basics and gradually building up to more advanced concepts.</p>
<section id="embarking-on-a-diy-journey-with-machine-learning-algorithms" class="level2">
<h2 class="anchored" data-anchor-id="embarking-on-a-diy-journey-with-machine-learning-algorithms">Embarking on a DIY Journey with Machine Learning Algorithms</h2>
<p>Why go through the trouble of building a machine learning algorithm by hand, especially when libraries like <code>sklearn</code> in Python or <code>rpart</code> in R are just a function call away? The answer lies in the deeper understanding and insights that come from peeling back the layers of these algorithms ourselves.</p>
</section>
<section id="practical-benefits-of-a-hands-on-approach" class="level2">
<h2 class="anchored" data-anchor-id="practical-benefits-of-a-hands-on-approach">Practical Benefits of a Hands-On Approach</h2>
<p>Beyond the theoretical, thereâ€™s immense practical value in understanding the inner workings of these models. It allows for more informed decisions about feature selectionâ€”knowing which to discard because they donâ€™t fit the modelâ€™s assumptions and which to transform for better representation. This knowledge often translates to improved model performance on new, unseen data.</p>
<p>And letâ€™s not overlook the sheer joy of the process. Diving deep into algorithms offers a unique way to tackle problem-solving, enhancing our execution and grasp of machine learning concepts.</p>
</section>
<section id="metrics-the-compass-for-improvement" class="level2">
<h2 class="anchored" data-anchor-id="metrics-the-compass-for-improvement">Metrics: The Compass for Improvement</h2>
<p>How do we navigate through the countless ways to split our data? We turn to optimization metrics, the compass guiding each iteration towards better performance. For decision trees, two key metrics stand out: Gini Impurity and Entropy.</p>
<section id="gini-impurity" class="level4">
<h4 class="anchored" data-anchor-id="gini-impurity">Gini Impurity</h4>
<p>Gini Impurity is an insightful metric focused on misclassification. It hinges on the probability of classifying a data point correctly within our dataset. For any given class <span class="math inline">\(c\)</span> with frequency <span class="math inline">\(f_c\)</span>, we predict that class for a data point <span class="math inline">\(f_c\)</span> proportion of the time. The error for each class is the chance of selecting the class multiplied by the likelihood of being incorrect:</p>
<p><span class="math display">\[Error_c = f_c \times (1 - f_c)\]</span></p>
<p>The Gini Impurity is the aggregate of these individual errors across all classes:</p>
<p><span class="math display">\[Gini\ Impurity = \sum_c f_c \times (1 - f_c) = \sum_c f_c - \sum_c f_c^2 = 1 - \sum_c f_c^2\]</span></p>
<p>Improving the Gini Impurity, specifically by minimizing it across data regions, directly leads to a reduction in misclassification.</p>
</section>
<section id="gini-impurity-illustrated-with-a-coin-toss" class="level4">
<h4 class="anchored" data-anchor-id="gini-impurity-illustrated-with-a-coin-toss">Gini Impurity Illustrated with a Coin Toss</h4>
<p>Consider the Gini Impurity of a coin flip, where the probability of heads is <span class="math inline">\(p_H\)</span>:</p>
<p><span class="math display">\[Gini\ Impurity = 1 - p_H^2 - (1 - p_H)^2 = 2 \times p_H \times (1 - p_H)\]</span></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="fl">0.01</span>, <span class="fl">0.99</span>, <span class="fl">0.01</span>)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(p, <span class="dv">1</span><span class="sc">-</span>p<span class="sc">^</span><span class="dv">2</span><span class="sc">-</span>(<span class="dv">1</span><span class="sc">-</span>p)<span class="sc">^</span><span class="dv">2</span>, <span class="at">type=</span><span class="st">'l'</span>, <span class="at">ylim=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>), </span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylab =</span> <span class="st">"Gini Impurity"</span>, <span class="at">xlab=</span><span class="st">"Probability of Heads"</span>, </span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>     <span class="at">col=</span><span class="st">"blue"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="2024-03-26-DT_files/figure-html/unnamed-chunk-1-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>When <span class="math inline">\(p_H\)</span> is at 0 or 1, thereâ€™s no chance of errorâ€”our predictions are certain. Yet at <span class="math inline">\(p_H = 0.5\)</span>, Gini Impurity peaks, reflecting the highest error rate and aligning with our intuitive understanding.</p>
</section>
<section id="entropy" class="level4">
<h4 class="anchored" data-anchor-id="entropy">Entropy</h4>
<p>Entropy, on the other hand, takes a different tack. It measures the expected information contentâ€”or surpriseâ€”of a class in a dataset. If <span class="math inline">\(f_c\)</span> is the proportion of a class, and <span class="math inline">\(I(c)\)</span> represents the information content of the class, then entropy is defined as:</p>
<p><span class="math display">\[Entropy = \sum_c f_c \times I(c)\]</span></p>
<p>Without delving too deep into the underlying theory, the formula for entropy, given that <span class="math inline">\(I(c) = -\log_2(f_c)\)</span>, simplifies to:</p>
<p><span class="math display">\[Entropy = -\sum_c f_c \times \log_2(f_c)\]</span></p>
<p>Though the logarithm base could be arbitrary, we align it with the binary nature of the decision trees weâ€™re examining in this series.</p>
</section>
<section id="entropy-in-the-context-of-a-coin-toss" class="level4">
<h4 class="anchored" data-anchor-id="entropy-in-the-context-of-a-coin-toss">Entropy in the Context of a Coin Toss</h4>
<p>Extending our analogy to the coin toss, letâ€™s examine how entropy changes with varying probabilities of heads, <span class="math inline">\(p_H\)</span>:</p>
<p><span class="math display">\[Entropy = -p_H \log_2(p_H) - (1 - p_H) \log_2(1 - p_H)\]</span></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="fl">0.01</span>, <span class="fl">0.99</span>, <span class="fl">0.01</span>)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(p, <span class="sc">-</span>p<span class="sc">*</span><span class="fu">log2</span>(p)<span class="sc">-</span>(<span class="dv">1</span><span class="sc">-</span>p)<span class="sc">*</span><span class="fu">log2</span>(<span class="dv">1</span><span class="sc">-</span>p), <span class="at">type=</span><span class="st">'l'</span>, <span class="at">ylim=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>), </span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylab =</span> <span class="st">"Entropy"</span>, <span class="at">xlab=</span><span class="st">"Probability of Heads"</span>, <span class="at">col=</span><span class="st">"blue"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="2024-03-26-DT_files/figure-html/unnamed-chunk-2-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Entropy achieves its maximum at <span class="math inline">\(p_H = 0.5\)</span>, where uncertaintyâ€”and the potential for errorâ€”is greatest. This resonates with the principle that the greatest entropy occurs where prediction is most challenging.</p>
<p>Refining Our Approach with Information Gain</p>
<p>With our metrics in place to judge how well our datasetâ€™s predictions are doing, itâ€™s time to focus on improvementâ€”how can we make our predictions even better? Weâ€™re going to talk about something called â€˜Information Gainâ€™, a concept which is the difference we want to maximize when deciding how to split our data.</p>
<p>Fine-tuning a Decision Tree for Classification</p>
<p>When we build a classifierâ€”a kind of decision treeâ€”our goal is to organize our data into groups that make our predictions as accurate as possible. The concept of â€˜Information Gainâ€™ is a bit like a treasure map; it helps us find these valuable groupings by measuring how much more ordered, or less chaotic, our data becomes after a split.</p>
<p><span class="math display">\[Information\ Gain = Gini\ Impurity_{before\ split} - \sum_{each\ split} \frac{|split\ group|}{|total\ data|} Gini\ Impurity_{split\ group}\]</span></p>
<p><span class="math display">\[Information\ Gain = Entropy_{before\ split} - \sum_{each\ split} \frac{|split\ group|}{|total\ data|} Entropy_{split\ group}\]</span></p>
<p>In these equations, <span class="math inline">\(Gini\ Impurity_{before\ split}\)</span> and <span class="math inline">\(Entropy_{before\ split}\)</span> represent the disorder in our data before any splits. The sum of the Gini Impurity or Entropy of each split group is weighted by the proportion of data in that group. The Information Gain is the difference between the disorder before the split and the weighted sum of disorder after the split.</p>
<p>In essence, it tells us how much clearer our predictions become after weâ€™ve sorted the data into separate buckets based on certain features.</p>
<p>Balancing Decision Trees to Avoid Overfitting</p>
<p>A common pitfall with decision trees is that they can get a little too enthusiastic, creating very specific rules that work perfectly for the data they were trained on but not so well for new data. This is known as overfitting.</p>
<p>To avoid this, we can trim or â€˜pruneâ€™ the tree after itâ€™s grown, or we can set some ground rules that stop the tree from getting overly complicated in the first place. These rules can include limits like:</p>
<ul>
<li>Maximum depth of the tree</li>
<li>Minimum number of data points to justify creating a new branch</li>
<li>Minimum improvement needed to make a new split</li>
<li>A threshold below which we wonâ€™t consider any new splits</li>
</ul>
<p>The Iris Dataset: Our Classification Playground Weâ€™ll be using the well-loved Iris dataset for classification tasks. The Species attribute will be our target for prediction. Hereâ€™s a peek at the dataset:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(datasets)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(iris)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(iris, <span class="dv">6</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  Sepal.Length Sepal.Width Petal.Length Petal.Width Species
1          5.1         3.5          1.4         0.2  setosa
2          4.9         3.0          1.4         0.2  setosa
3          4.7         3.2          1.3         0.2  setosa
4          4.6         3.1          1.5         0.2  setosa
5          5.0         3.6          1.4         0.2  setosa
6          5.4         3.9          1.7         0.4  setosa</code></pre>
</div>
</div>
<p>By using the Iris dataset, we can focus on classifying flower species, a perfect starting point for practicing with decision trees.</p>
<p>Building the Classifier: The Search for the First Split In our script, weâ€™re not just taking wild guesses. Weâ€™re methodically examining each feature to find the value that offers the best division of our data, aiming to increase Information Gain.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>entropy <span class="ot">&lt;-</span> <span class="cf">function</span>(y) {</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">length</span>(y) <span class="sc">==</span> <span class="dv">0</span>) <span class="fu">return</span>(<span class="dv">0</span>)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>  p <span class="ot">&lt;-</span> <span class="fu">table</span>(y) <span class="sc">/</span> <span class="fu">length</span>(y)</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sum</span>(<span class="sc">-</span>p <span class="sc">*</span> <span class="fu">log2</span>(p <span class="sc">+</span> <span class="fl">1e-9</span>))</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>gini_impurity <span class="ot">&lt;-</span> <span class="cf">function</span>(y) {</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">length</span>(y) <span class="sc">==</span> <span class="dv">0</span>) <span class="fu">return</span>(<span class="dv">0</span>)</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>  p <span class="ot">&lt;-</span> <span class="fu">table</span>(y) <span class="sc">/</span> <span class="fu">length</span>(y)</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>  <span class="dv">1</span> <span class="sc">-</span> <span class="fu">sum</span>(p<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now we can calculate the Information Gain, considering the improvements brought by different partitions in our data. We use a maskâ€”a logical vector indicating if a row belongs to the first or second partitionâ€”to guide this process:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>information_gain <span class="ot">&lt;-</span> <span class="cf">function</span>(y, mask, <span class="at">metric_func =</span> entropy) {</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># We don't want partitions with no data points</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">sum</span>(mask) <span class="sc">==</span> <span class="dv">0</span> <span class="sc">||</span> <span class="fu">sum</span>(<span class="sc">!</span>mask) <span class="sc">==</span> <span class="dv">0</span>) <span class="fu">return</span>(<span class="dv">0</span>)</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">metric_func</span>(y) <span class="sc">-</span> (<span class="fu">sum</span>(mask) <span class="sc">/</span> <span class="fu">length</span>(mask)) <span class="sc">*</span> <span class="fu">metric_func</span>(y[mask]) <span class="sc">-</span> </span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>    (<span class="fu">sum</span>(<span class="sc">!</span>mask) <span class="sc">/</span> <span class="fu">length</span>(<span class="sc">!</span>mask)) <span class="sc">*</span> <span class="fu">metric_func</span>(y[<span class="sc">!</span>mask])</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Seeking the Best Split Across All Features With our metric functions in hand, weâ€™ll comb through all the features to find the ultimate split:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>max_information_gain_split <span class="ot">&lt;-</span> <span class="cf">function</span>(y, x, <span class="at">metric_func =</span> gini_impurity) {</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Initialize the best change and split value</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>  best_change <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>  split_value <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Check if the feature is numeric or categorical</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>  is_numeric <span class="ot">&lt;-</span> <span class="sc">!</span>(<span class="fu">is.factor</span>(x) <span class="sc">||</span> <span class="fu">is.logical</span>(x) <span class="sc">||</span> <span class="fu">is.character</span>(x))</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(val <span class="cf">in</span> <span class="fu">sort</span>(<span class="fu">unique</span>(x))) {</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>    mask <span class="ot">&lt;-</span> <span class="cf">if</span> (is_numeric) { x <span class="sc">&lt;</span> val } <span class="cf">else</span> { x <span class="sc">==</span> val }</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>    change <span class="ot">&lt;-</span> <span class="fu">information_gain</span>(y, mask, metric_func)</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="fu">is.na</span>(best_change) <span class="sc">||</span> change <span class="sc">&gt;</span> best_change) {</span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>      best_change <span class="ot">&lt;-</span> change</span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>      split_value <span class="ot">&lt;-</span> val</span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">list</span>(<span class="st">"best_change"</span> <span class="ot">=</span> best_change, <span class="st">"split_value"</span> <span class="ot">=</span> split_value, <span class="st">"is_numeric"</span> <span class="ot">=</span> is_numeric))</span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now, letâ€™s use this to find the best split for a single feature:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">max_information_gain_split</span>(iris<span class="sc">$</span>Species, iris<span class="sc">$</span>Petal.Width))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$best_change
[1] 0.3333333

$split_value
[1] 1

$is_numeric
[1] TRUE</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sapply</span>(iris[, <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>], <span class="cf">function</span>(x) <span class="fu">max_information_gain_split</span>(iris<span class="sc">$</span>Species, x))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>            Sepal.Length Sepal.Width Petal.Length Petal.Width
best_change 0.2277603    0.1269234   0.3333333    0.3333333  
split_value 5.5          3.4         3            1          
is_numeric  TRUE         TRUE        TRUE         TRUE       </code></pre>
</div>
</div>
<p>After determining the feature and value that provide the most significant information gain, we can then carve our dataset into two distinct sets. Think of it like sorting a deck of cards where one feature is the deciding factor.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>best_feature_split <span class="ot">&lt;-</span> <span class="cf">function</span>(X, y) {</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>  results <span class="ot">&lt;-</span> <span class="fu">sapply</span>(X, <span class="cf">function</span>(x) <span class="fu">max_information_gain_split</span>(y, x))</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>  best_name <span class="ot">&lt;-</span> <span class="fu">names</span>(<span class="fu">which.max</span>(results[<span class="st">'best_change'</span>,]))</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>  best_result <span class="ot">&lt;-</span> results[, best_name]</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>  best_result[[<span class="st">"name"</span>]] <span class="ot">&lt;-</span> best_name</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(best_result)</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Letâ€™s run it for the iris dataset and see which feature provides the best split.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">as.data.frame</span>(<span class="fu">best_feature_split</span>(iris[, <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>], iris[, <span class="dv">5</span>]))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  best_change split_value is_numeric         name
1   0.3333333           3       TRUE Petal.Length</code></pre>
</div>
</div>
<p>This neat little function sifts through our data and finds the golden splitâ€”the point where dividing our dataset yields the most clarity according to our chosen metric.</p>
<p>Now, imagine weâ€™ve found our winning feature. The next step is to partition the iris dataset into two new datasets based on this feature. Weâ€™ll refer to them as â€˜leftâ€™ and â€˜rightâ€™ datasets, aligning with the branching structure of a tree.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>get_best_mask <span class="ot">&lt;-</span> <span class="cf">function</span>(X, best_feature_list) {</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>  best_mask <span class="ot">&lt;-</span> X[, best_feature_list<span class="sc">$</span>name] <span class="sc">&lt;</span> best_feature_list<span class="sc">$</span>split_value</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(best_mask)</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Weâ€™ll get the best mask and split the iris dataset accordingly.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>best_iris_split <span class="ot">&lt;-</span> <span class="fu">best_feature_split</span>(iris[, <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>], iris[, <span class="dv">5</span>])</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>best_iris_mask <span class="ot">&lt;-</span> <span class="fu">get_best_mask</span>(iris[, <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>], best_iris_split)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Partition the iris dataset into â€˜leftâ€™ and â€˜rightâ€™</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>left_iris <span class="ot">&lt;-</span> iris[best_iris_mask, ]</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>right_iris <span class="ot">&lt;-</span> iris[<span class="sc">!</span>best_iris_mask, ]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>And just like that, with our data now split into â€˜leftâ€™ and â€˜rightâ€™, weâ€™ve taken the first step in constructing our decision tree. This process will serve as the foundation for building a data structure that captures the essence of our tree, complete with branches that stem from each decision point.</p>
</section>
</section>
</section>
<section id="building-our-decision-tree" class="level1">
<h1>Building our Decision Tree</h1>
<p>Now that weâ€™ve laid the groundwork, get ready because weâ€™re about to build our decision tree from scratch. Wish me luck!</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>calculate_entropy <span class="ot">&lt;-</span> <span class="cf">function</span>(y) {</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">length</span>(y) <span class="sc">==</span> <span class="dv">0</span>) <span class="fu">return</span>(<span class="dv">0</span>)</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>  p <span class="ot">&lt;-</span> <span class="fu">table</span>(y) <span class="sc">/</span> <span class="fu">length</span>(y)</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>  <span class="sc">-</span><span class="fu">sum</span>(p <span class="sc">*</span> <span class="fu">log2</span>(p <span class="sc">+</span> <span class="fl">1e-9</span>))</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>calculate_gini_impurity <span class="ot">&lt;-</span> <span class="cf">function</span>(y) {</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">length</span>(y) <span class="sc">==</span> <span class="dv">0</span>) <span class="fu">return</span>(<span class="dv">0</span>)</span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>  p <span class="ot">&lt;-</span> <span class="fu">table</span>(y) <span class="sc">/</span> <span class="fu">length</span>(y)</span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>  <span class="dv">1</span> <span class="sc">-</span> <span class="fu">sum</span>(p<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a>calculate_information_gain <span class="ot">&lt;-</span> <span class="cf">function</span>(y, mask, metric_func) {</span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a>  s1 <span class="ot">&lt;-</span> <span class="fu">sum</span>(mask)</span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a>  s2 <span class="ot">&lt;-</span> <span class="fu">length</span>(mask) <span class="sc">-</span> s1</span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (s1 <span class="sc">==</span> <span class="dv">0</span> <span class="sc">||</span> s2 <span class="sc">==</span> <span class="dv">0</span>) <span class="fu">return</span>(<span class="dv">0</span>)</span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">metric_func</span>(y) <span class="sc">-</span> s1 <span class="sc">/</span> (s1 <span class="sc">+</span> s2) <span class="sc">*</span> <span class="fu">metric_func</span>(y[mask]) <span class="sc">-</span> s2 <span class="sc">/</span> (s1 <span class="sc">+</span> s2) <span class="sc">*</span> <span class="fu">metric_func</span>(y[<span class="sc">!</span>mask])</span>
<span id="cb18-18"><a href="#cb18-18" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb18-19"><a href="#cb18-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-20"><a href="#cb18-20" aria-hidden="true" tabindex="-1"></a>find_best_split <span class="ot">&lt;-</span> <span class="cf">function</span>(X, y, metric_func) {</span>
<span id="cb18-21"><a href="#cb18-21" aria-hidden="true" tabindex="-1"></a>  features <span class="ot">&lt;-</span> <span class="fu">names</span>(X)</span>
<span id="cb18-22"><a href="#cb18-22" aria-hidden="true" tabindex="-1"></a>  best_gain <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb18-23"><a href="#cb18-23" aria-hidden="true" tabindex="-1"></a>  best_split <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb18-24"><a href="#cb18-24" aria-hidden="true" tabindex="-1"></a>  best_feature <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb18-25"><a href="#cb18-25" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (feature <span class="cf">in</span> features) {</span>
<span id="cb18-26"><a href="#cb18-26" aria-hidden="true" tabindex="-1"></a>    unique_values <span class="ot">&lt;-</span> <span class="fu">unique</span>(X[[feature]])</span>
<span id="cb18-27"><a href="#cb18-27" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (value <span class="cf">in</span> unique_values) {</span>
<span id="cb18-28"><a href="#cb18-28" aria-hidden="true" tabindex="-1"></a>      mask <span class="ot">&lt;-</span> X[[feature]] <span class="sc">&lt;</span> value</span>
<span id="cb18-29"><a href="#cb18-29" aria-hidden="true" tabindex="-1"></a>      gain <span class="ot">&lt;-</span> <span class="fu">calculate_information_gain</span>(y, mask, metric_func)</span>
<span id="cb18-30"><a href="#cb18-30" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (gain <span class="sc">&gt;</span> best_gain) {</span>
<span id="cb18-31"><a href="#cb18-31" aria-hidden="true" tabindex="-1"></a>        best_gain <span class="ot">&lt;-</span> gain</span>
<span id="cb18-32"><a href="#cb18-32" aria-hidden="true" tabindex="-1"></a>        best_split <span class="ot">&lt;-</span> value</span>
<span id="cb18-33"><a href="#cb18-33" aria-hidden="true" tabindex="-1"></a>        best_feature <span class="ot">&lt;-</span> feature</span>
<span id="cb18-34"><a href="#cb18-34" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb18-35"><a href="#cb18-35" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb18-36"><a href="#cb18-36" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb18-37"><a href="#cb18-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(<span class="at">gain =</span> best_gain, <span class="at">feature =</span> best_feature, <span class="at">split =</span> best_split)</span>
<span id="cb18-38"><a href="#cb18-38" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb18-39"><a href="#cb18-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-40"><a href="#cb18-40" aria-hidden="true" tabindex="-1"></a>split_data <span class="ot">&lt;-</span> <span class="cf">function</span>(X, y, best_split) {</span>
<span id="cb18-41"><a href="#cb18-41" aria-hidden="true" tabindex="-1"></a>  mask <span class="ot">&lt;-</span> X[[best_split<span class="sc">$</span>feature]] <span class="sc">&lt;</span> best_split<span class="sc">$</span>split</span>
<span id="cb18-42"><a href="#cb18-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(</span>
<span id="cb18-43"><a href="#cb18-43" aria-hidden="true" tabindex="-1"></a>    <span class="at">left_X =</span> X[mask, ],</span>
<span id="cb18-44"><a href="#cb18-44" aria-hidden="true" tabindex="-1"></a>    <span class="at">left_y =</span> y[mask],</span>
<span id="cb18-45"><a href="#cb18-45" aria-hidden="true" tabindex="-1"></a>    <span class="at">right_X =</span> X[<span class="sc">!</span>mask, ],</span>
<span id="cb18-46"><a href="#cb18-46" aria-hidden="true" tabindex="-1"></a>    <span class="at">right_y =</span> y[<span class="sc">!</span>mask]</span>
<span id="cb18-47"><a href="#cb18-47" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb18-48"><a href="#cb18-48" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb18-49"><a href="#cb18-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-50"><a href="#cb18-50" aria-hidden="true" tabindex="-1"></a>create_decision_tree <span class="ot">&lt;-</span> <span class="cf">function</span>(X, y, <span class="at">max_depth =</span> <span class="dv">3</span>, <span class="at">depth =</span> <span class="dv">0</span>, <span class="at">metric_func =</span> calculate_gini_impurity) {</span>
<span id="cb18-51"><a href="#cb18-51" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (depth <span class="sc">==</span> max_depth <span class="sc">||</span> <span class="fu">length</span>(<span class="fu">unique</span>(y)) <span class="sc">==</span> <span class="dv">1</span>) {</span>
<span id="cb18-52"><a href="#cb18-52" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="fu">list</span>(<span class="at">prediction =</span> <span class="fu">ifelse</span>(<span class="fu">is.factor</span>(y), <span class="fu">names</span>(<span class="fu">sort</span>(<span class="sc">-</span><span class="fu">table</span>(y)))[<span class="dv">1</span>], <span class="fu">mean</span>(y))))</span>
<span id="cb18-53"><a href="#cb18-53" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb18-54"><a href="#cb18-54" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb18-55"><a href="#cb18-55" aria-hidden="true" tabindex="-1"></a>  best_split <span class="ot">&lt;-</span> <span class="fu">find_best_split</span>(X, y, metric_func)</span>
<span id="cb18-56"><a href="#cb18-56" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (best_split<span class="sc">$</span>gain <span class="sc">==</span> <span class="dv">0</span>) {</span>
<span id="cb18-57"><a href="#cb18-57" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="fu">list</span>(<span class="at">prediction =</span> <span class="fu">ifelse</span>(<span class="fu">is.factor</span>(y), <span class="fu">names</span>(<span class="fu">sort</span>(<span class="sc">-</span><span class="fu">table</span>(y)))[<span class="dv">1</span>], <span class="fu">mean</span>(y))))</span>
<span id="cb18-58"><a href="#cb18-58" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb18-59"><a href="#cb18-59" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb18-60"><a href="#cb18-60" aria-hidden="true" tabindex="-1"></a>  split_sets <span class="ot">&lt;-</span> <span class="fu">split_data</span>(X, y, best_split)</span>
<span id="cb18-61"><a href="#cb18-61" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">list</span>(</span>
<span id="cb18-62"><a href="#cb18-62" aria-hidden="true" tabindex="-1"></a>    <span class="at">feature =</span> best_split<span class="sc">$</span>feature,</span>
<span id="cb18-63"><a href="#cb18-63" aria-hidden="true" tabindex="-1"></a>    <span class="at">split =</span> best_split<span class="sc">$</span>split,</span>
<span id="cb18-64"><a href="#cb18-64" aria-hidden="true" tabindex="-1"></a>    <span class="at">left =</span> <span class="fu">create_decision_tree</span>(split_sets<span class="sc">$</span>left_X, split_sets<span class="sc">$</span>left_y, max_depth, depth <span class="sc">+</span> <span class="dv">1</span>, metric_func),</span>
<span id="cb18-65"><a href="#cb18-65" aria-hidden="true" tabindex="-1"></a>    <span class="at">right =</span> <span class="fu">create_decision_tree</span>(split_sets<span class="sc">$</span>right_X, split_sets<span class="sc">$</span>right_y, max_depth, depth <span class="sc">+</span> <span class="dv">1</span>, metric_func)</span>
<span id="cb18-66"><a href="#cb18-66" aria-hidden="true" tabindex="-1"></a>  ))</span>
<span id="cb18-67"><a href="#cb18-67" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb18-68"><a href="#cb18-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-69"><a href="#cb18-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-70"><a href="#cb18-70" aria-hidden="true" tabindex="-1"></a>print_decision_tree <span class="ot">&lt;-</span> <span class="cf">function</span>(node, <span class="at">prefix =</span> <span class="st">""</span>) {</span>
<span id="cb18-71"><a href="#cb18-71" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(node<span class="sc">$</span>prediction)) {</span>
<span id="cb18-72"><a href="#cb18-72" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(prefix, <span class="st">"Predict:"</span>, node<span class="sc">$</span>prediction, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb18-73"><a href="#cb18-73" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb18-74"><a href="#cb18-74" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(prefix, <span class="st">"If"</span>, node<span class="sc">$</span>feature, <span class="st">"&lt;"</span>, node<span class="sc">$</span>split, <span class="st">":</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb18-75"><a href="#cb18-75" aria-hidden="true" tabindex="-1"></a>    <span class="fu">print_decision_tree</span>(node<span class="sc">$</span>left, <span class="fu">paste0</span>(prefix, <span class="st">"  "</span>))</span>
<span id="cb18-76"><a href="#cb18-76" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb18-77"><a href="#cb18-77" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(prefix, <span class="st">"Else ("</span>, node<span class="sc">$</span>feature, <span class="st">"&gt;="</span>, node<span class="sc">$</span>split, <span class="st">"):</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb18-78"><a href="#cb18-78" aria-hidden="true" tabindex="-1"></a>    <span class="fu">print_decision_tree</span>(node<span class="sc">$</span>right, <span class="fu">paste0</span>(prefix, <span class="st">"  "</span>))</span>
<span id="cb18-79"><a href="#cb18-79" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb18-80"><a href="#cb18-80" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb18-81"><a href="#cb18-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-82"><a href="#cb18-82" aria-hidden="true" tabindex="-1"></a>iris_tree <span class="ot">&lt;-</span> <span class="fu">create_decision_tree</span>(iris[, <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>], iris[, <span class="dv">5</span>], <span class="at">max_depth =</span> <span class="dv">3</span>)</span>
<span id="cb18-83"><a href="#cb18-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-84"><a href="#cb18-84" aria-hidden="true" tabindex="-1"></a><span class="fu">print_decision_tree</span>(iris_tree)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> If Petal.Length &lt; 3 :
   Predict: setosa 
 Else ( Petal.Length &gt;= 3 ):
   If Petal.Width &lt; 1.8 :
     If Petal.Length &lt; 5 :
       Predict: versicolor 
     Else ( Petal.Length &gt;= 5 ):
       Predict: virginica 
   Else ( Petal.Width &gt;= 1.8 ):
     If Petal.Length &lt; 4.9 :
       Predict: virginica 
     Else ( Petal.Length &gt;= 4.9 ):
       Predict: virginica </code></pre>
</div>
</div>
<section id="comparing-our-tree-to-rpart" class="level2">
<h2 class="anchored" data-anchor-id="comparing-our-tree-to-rpart">Comparing Our Tree to <code>rpart</code></h2>
<p>After meticulously constructing our decision tree from scratch and gaining insights into its inner workings, itâ€™s illuminating to compare our results with those from the well-established <code>rpart</code> package. This comparison not only validates our approach but also offers perspective on how different methodologies might influence the modelâ€™s structure and performance.</p>
</section>
<section id="building-the-tree-with-rpart" class="level2">
<h2 class="anchored" data-anchor-id="building-the-tree-with-rpart">Building the Tree with <code>rpart</code></h2>
<p>To make this comparison, we first need to construct a decision tree using rpart on the same dataset:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rpart)</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Building the decision tree model with rpart</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>rpart_tree <span class="ot">&lt;-</span> <span class="fu">rpart</span>(Species <span class="sc">~</span> ., <span class="at">data =</span> iris, <span class="at">method =</span> <span class="st">"class"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Summary of the rpart tree</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(rpart_tree)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
rpart(formula = Species ~ ., data = iris, method = "class")
  n= 150 

    CP nsplit rel error xerror       xstd
1 0.50      0      1.00   1.23 0.04705316
2 0.44      1      0.50   0.66 0.06079474
3 0.01      2      0.06   0.09 0.02908608

Variable importance
 Petal.Width Petal.Length Sepal.Length  Sepal.Width 
          34           31           21           14 

Node number 1: 150 observations,    complexity param=0.5
  predicted class=setosa      expected loss=0.6666667  P(node) =1
    class counts:    50    50    50
   probabilities: 0.333 0.333 0.333 
  left son=2 (50 obs) right son=3 (100 obs)
  Primary splits:
      Petal.Length &lt; 2.45 to the left,  improve=50.00000, (0 missing)
      Petal.Width  &lt; 0.8  to the left,  improve=50.00000, (0 missing)
      Sepal.Length &lt; 5.45 to the left,  improve=34.16405, (0 missing)
      Sepal.Width  &lt; 3.35 to the right, improve=19.03851, (0 missing)
  Surrogate splits:
      Petal.Width  &lt; 0.8  to the left,  agree=1.000, adj=1.00, (0 split)
      Sepal.Length &lt; 5.45 to the left,  agree=0.920, adj=0.76, (0 split)
      Sepal.Width  &lt; 3.35 to the right, agree=0.833, adj=0.50, (0 split)

Node number 2: 50 observations
  predicted class=setosa      expected loss=0  P(node) =0.3333333
    class counts:    50     0     0
   probabilities: 1.000 0.000 0.000 

Node number 3: 100 observations,    complexity param=0.44
  predicted class=versicolor  expected loss=0.5  P(node) =0.6666667
    class counts:     0    50    50
   probabilities: 0.000 0.500 0.500 
  left son=6 (54 obs) right son=7 (46 obs)
  Primary splits:
      Petal.Width  &lt; 1.75 to the left,  improve=38.969400, (0 missing)
      Petal.Length &lt; 4.75 to the left,  improve=37.353540, (0 missing)
      Sepal.Length &lt; 6.15 to the left,  improve=10.686870, (0 missing)
      Sepal.Width  &lt; 2.45 to the left,  improve= 3.555556, (0 missing)
  Surrogate splits:
      Petal.Length &lt; 4.75 to the left,  agree=0.91, adj=0.804, (0 split)
      Sepal.Length &lt; 6.15 to the left,  agree=0.73, adj=0.413, (0 split)
      Sepal.Width  &lt; 2.95 to the left,  agree=0.67, adj=0.283, (0 split)

Node number 6: 54 observations
  predicted class=versicolor  expected loss=0.09259259  P(node) =0.36
    class counts:     0    49     5
   probabilities: 0.000 0.907 0.093 

Node number 7: 46 observations
  predicted class=virginica   expected loss=0.02173913  P(node) =0.3066667
    class counts:     0     1    45
   probabilities: 0.000 0.022 0.978 </code></pre>
</div>
</div>
<p>This code snippet fits a decision tree to predict the Species from the iris dataset, mimicking the setup of our manually built tree. The summary provides detailed information about the treeâ€™s splits, size, and predictive performance.</p>
<section id="visualizing-the-rpart-tree" class="level3">
<h3 class="anchored" data-anchor-id="visualizing-the-rpart-tree">Visualizing the rpart Tree</h3>
<p>Visualizing the tree helps in understanding the decisions it makes. The <code>rpart.plot</code> package offers tools for this purpose:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rpart.plot)</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="fu">rpart.plot</span>(rpart_tree, <span class="at">type =</span> <span class="dv">3</span>, <span class="at">box.palette =</span> <span class="st">"RdBu"</span>, <span class="at">extra =</span> <span class="dv">104</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="2024-03-26-DT_files/figure-html/unnamed-chunk-17-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>This visualization shows the splits made by the tree, the criteria for each decision, and the distribution of classes at each node. The type, color palette, and extra parameters are adjustable to enhance readability and insight.</p>
</section>
</section>
<section id="evaluating-the-models" class="level2">
<h2 class="anchored" data-anchor-id="evaluating-the-models">Evaluating the Models</h2>
<p>With both trees constructed, we can now evaluate their performance on the dataset. This comparison will shed light on the predictive power of each model and how they differ in their decision-making processes.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>predict_manual_tree <span class="ot">&lt;-</span> <span class="cf">function</span>(tree, newdata) {</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(tree<span class="sc">$</span>prediction)) {</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># If it's a leaf node, return the prediction</span></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(tree<span class="sc">$</span>prediction)</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Determine whether to follow the left or right branch</span></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(tree<span class="sc">$</span>split) <span class="sc">&amp;&amp;</span> newdata[[tree<span class="sc">$</span>feature]] <span class="sc">&lt;</span> tree<span class="sc">$</span>split) {</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>      <span class="fu">return</span>(<span class="fu">predict_manual_tree</span>(tree<span class="sc">$</span>left, newdata))</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>      <span class="fu">return</span>(<span class="fu">predict_manual_tree</span>(tree<span class="sc">$</span>right, newdata))</span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true" tabindex="-1"></a>predicted_manual <span class="ot">&lt;-</span> <span class="fu">sapply</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(iris), <span class="cf">function</span>(i) <span class="fu">predict_manual_tree</span>(iris_tree, iris[i, ]))</span>
<span id="cb24-16"><a href="#cb24-16" aria-hidden="true" tabindex="-1"></a>manual_accuracy <span class="ot">&lt;-</span> <span class="fu">mean</span>(predicted_manual <span class="sc">==</span> iris<span class="sc">$</span>Species)</span>
<span id="cb24-17"><a href="#cb24-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-18"><a href="#cb24-18" aria-hidden="true" tabindex="-1"></a><span class="co"># For the rpart tree</span></span>
<span id="cb24-19"><a href="#cb24-19" aria-hidden="true" tabindex="-1"></a>predicted_rpart <span class="ot">&lt;-</span> <span class="fu">predict</span>(rpart_tree, iris, <span class="at">type =</span> <span class="st">"class"</span>)</span>
<span id="cb24-20"><a href="#cb24-20" aria-hidden="true" tabindex="-1"></a>rpart_accuracy <span class="ot">&lt;-</span> <span class="fu">mean</span>(predicted_rpart <span class="sc">==</span> iris<span class="sc">$</span>Species)</span>
<span id="cb24-21"><a href="#cb24-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-22"><a href="#cb24-22" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Manual Tree Accuracy:"</span>, manual_accuracy, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Manual Tree Accuracy: 0.9733333 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Rpart Tree Accuracy:"</span>, rpart_accuracy, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rpart Tree Accuracy: 0.96 </code></pre>
</div>
</div>
<p>Interesting! Our manually constructed tree had higher accuracy than the rpart tree on the iris dataset. How did that happen? The difference in accuracy could be due to the hyperparameters used, the splitting criterion, or the stopping criteria. Itâ€™s a reminder that the choice of algorithm and its parameters can significantly impact the modelâ€™s performance.</p>
</section>
<section id="conclusion" class="level2">
<h2 class="anchored" data-anchor-id="conclusion">Conclusion</h2>
<p>In this project, we delved into the inner workings of decision trees, building one from scratch and comparing it with the <code>rpart</code> package. We explored the concepts of entropy, information gain, and Gini impurity, which are fundamental to decision tree algorithms. By constructing a decision tree manually, we gained a deeper understanding of how these models make decisions and split the data.</p>
<p>Thank you! I hope you learned as much as I did while working on this post! If you have any questions or feedback, please feel free to reach out. Happy learning!</p>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "î§‹";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<script src="https://utteranc.es/client.js" repo="jacobjameson/jacobjameson.github.io" issue-term="pathname" theme="github-light" crossorigin="anonymous" async="">
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">Copyright 2024, Jacob Jameson</div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>



</body></html>