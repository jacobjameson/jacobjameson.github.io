{
  "hash": "8a2dd3f3b366ef6dd2df33b5a8435088",
  "result": {
    "markdown": "---\ntitle: \"The 'Odd' Obsession with Odds Ratios: Making a Case for Marginal Effects in Health Research\"\ndescription: \"Marginal Effects >>> Odds Ratios\"\nauthor: \"Jacob Jameson\"\ndate: \"2023-09-01\"\ncategories: [marginal effects]\noutput:\n  tufte::tufte_html: default\n  tufte::tufte_handout:\n    citation_package: natbib\n    latex_engine: xelatex\n  tufte::tufte_book:\n    citation_package: natbib\n    latex_engine: xelatex\nlink-citations: yes\nreference-location: margin\ncomments:\n  utterances:\n    repo: jacobjameson/jacobjameson.github.io\nformat:\n  html:\n    theme: slate\n---\n\n\n\n\n\nOdds ratios have been a long-standing mainstay in health research. Their use can be found sprinkled throughout countless academic journals and research papers. But just because something is popular doesn't mean it's the best choice for all contexts. The purpose of this article is to shed light on the limitations of odds ratios, particularly when it comes to interpretation, and advocate for the more intuitive marginal effects and predicted probabilities.\n\n\n## The math behind odds ratios\n\nTo understand why odds ratios can be confusing, let's briefly discuss what they represent.\n\nIn a logistic regression, the fundamental equation is:\n\n\n$$log(\\frac{p}{1-p}) = \\beta_0 + \\beta_1X_1 + \\beta_2X_2 + ...$$\n\n\nWhere $p$ is the probability of an event occurring.\n\nThe odds ratio for a given predictor (let's say $X_1$) is simply the exponentiated coefficient for that predictor:\n\n\nOdds Ratio for $X_1 = E^{\\beta_1}$\n\nIt represents the multiplicative change in the odds of the outcome for a one-unit increase in $X_1$ , holding other variables constant. If this sounds confusing, you're not alone.\n\n\n## When Odds Ratios Mislead\n\nThe challenge with odds ratios arises particularly when the outcome of interest is common. The reason being, odds ratios tend to exaggerate relative risks for common outcomes.\n\nLet's say we find an odds ratio of 2 for a drug reducing heart attack risk. Many might (mistakenly) interpret this as \"patients on the drug are twice as likely to avoid heart attacks.\" In reality, they have twice the odds, which doesnâ€™t translate directly to actual probabilities, especially when the event is common.\n\n## Marginal Effects: Clarity over Confusion\n\nMarginal effects shine where odds ratios falter. They convey the change in the probability of an outcome for a one-unit change in the predictor, holding other variables constant. It's a direct measure that offers a tangible understanding of impact.\n\nMathematically, for a binary predictor (like drug use: yes or no):\n\n\n$$\\text{Marginal Effect} (dy/dx) = P(Y = 1|X=1) - P(Y=1|X=0)$$\n\nFor continuous predictors, the marginal effect represents the derivative of the probability with respect to the predictor, which essentially gives us the rate of change.\n\n## Predicted Probabilities: Concrete Scenarios Over Abstract Odds\n\nPredicted probabilities go a step further, providing the likelihood of an outcome under specific conditions. Instead of leaving things in the realm of odds and abstract increases, we can state tangible scenarios.\n\n\n\n## Demonstrating with \"Real-World\" Data\n\n\nTo provide concrete evidence of the limitations of odds ratios, let's explore a simulated dataset that mirrors a health study on heart attacks, age, and drug use for high-risk individuals.\n\nFirst, we'll generate a dataset with age as a continuous predictor and drug_use as a binary predictor:\n\n*Simulate data*\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"Show the code\"}\n# Setting the seed for reproducibility\nset.seed(1234)\n\nn <- 1000\n\n# Age distribution: Normally distributed between 40 and 70\nage <- rnorm(n, 55, 7.5)\n\n# Drug use: 50% of the participants use the drug\ndrug_use <- rbinom(n, 1, 0.5)\n\n# Log odds of heart attack: Base risk, then increasing slightly with age, \n# and decreasing with drug use (this is where we're setting the odds ratio to roughly 2 for drug use)\nlog_odds_heart_attack <- -2 + 0.04 * age - log(2) * drug_use\n\n# Converting log odds to probability\nprob_heart_attack <- exp(log_odds_heart_attack) / (1 + exp(log_odds_heart_attack))\n\n# Simulating whether a heart attack occurs or not\nheart_attack <- rbinom(n, 1, prob_heart_attack)\n\n# Create a dataframe\ndata_high_risk <- data.frame(age, drug_use, heart_attack)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nnrow(data_high_risk)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 1000\n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ndata_high_risk\n```\n:::\n\n::: {.cell}\n::: {.cell-output-display}\n`````{=html}\n<table class=\"table table-striped table-hover table-condensed table-responsive\" style=\"font-size: 15px; margin-left: auto; margin-right: auto;\">\n <thead>\n  <tr>\n   <th style=\"text-align:right;\"> age </th>\n   <th style=\"text-align:right;\"> drug_use </th>\n   <th style=\"text-align:right;\"> heart_attack </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:right;\"> 45.94701 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 1 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 57.08072 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 1 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 63.13331 </td>\n   <td style=\"text-align:right;\"> 1 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 37.40727 </td>\n   <td style=\"text-align:right;\"> 1 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 58.21844 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 1 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 58.79542 </td>\n   <td style=\"text-align:right;\"> 1 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 50.68945 </td>\n   <td style=\"text-align:right;\"> 1 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 50.90026 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 50.76661 </td>\n   <td style=\"text-align:right;\"> 1 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 48.32472 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 1 </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n\n\n\n### Modeling and Results\n\nUsing a logistic regression, we'll model the probability of a heart attack based on age and drug use:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmodel_high_risk <- glm(heart_attack ~ age + drug_use, \n                       data=data_high_risk, family = binomial)\n\nsummary(model_high_risk)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\nCall:\nglm(formula = heart_attack ~ age + drug_use, family = binomial, \n    data = data_high_risk)\n\nDeviance Residuals: \n   Min      1Q  Median      3Q     Max  \n-1.662  -1.049  -0.854   1.188   1.685  \n\nCoefficients:\n            Estimate Std. Error z value Pr(>|z|)    \n(Intercept) -2.24031    0.49848  -4.494 6.98e-06 ***\nage          0.04281    0.00896   4.777 1.78e-06 ***\ndrug_use    -0.66254    0.13064  -5.072 3.94e-07 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n(Dispersion parameter for binomial family taken to be 1)\n\n    Null deviance: 1373.7  on 999  degrees of freedom\nResidual deviance: 1324.4  on 997  degrees of freedom\nAIC: 1330.4\n\nNumber of Fisher Scoring iterations: 4\n```\n:::\n:::\n\n\nUpon examining the output, you'll observe an odds ratio close to 2 for drug use (exponentiate the coeffecient). A common misinterpretation might be: \"Patients on the drug have twice the likelihood to avoid heart attacks.\" This is a misconception. They have twice the odds, not twice the probability. This distinction becomes especially murky when the event (heart attack) is common.\n\n### Marginal Effects and Interpretation\n\nThe marginal effect of the drug can be found by computing the difference in predicted probabilities between drug users and non-users, holding other variables constant. This gives a more direct measure of the drug's impact on the probability of heart attack.\n\nUsing our model, you can compute the marginal effect for any given age. For example, for someone aged 55:\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\npredicted_prob_on_drug <- predict(model_high_risk, \n                                  newdata = data.frame(age = 55, drug_use = 1),\n                                  type = \"response\")\n\npredicted_prob_off_drug <- predict(model_high_risk, \n                                   newdata = data.frame(age = 55, drug_use = 0),\n                                   type = \"response\")\n\nmarginal_effect_55 <- predicted_prob_on_drug - predicted_prob_off_drug\n\nmarginal_effect_55\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n         1 \n-0.1622666 \n```\n:::\n:::\n\n\nThe result is a clear percentage point decrease in the probability of a heart attack for drug users compared to non-users.\n\n**This means that, for individuals aged 55, using the drug results in a 16 percentage point decrease in the probability of experiencing a heart attack compared to those not using the drug.** This direct interpretation offers a tangible sense of the drug's impact and is far more intuitive than grappling with odds ratios.\n\n## Average Marginal Effects: A Comprehensive View\n\nBeyond just evaluating the marginal effect at specific values, we can compute the average marginal effect (AME) across our sample. AMEs provide a holistic view of the predictor's impact by averaging its effects over all observations in our dataset. It's particularly insightful when dealing with continuous predictors like age.\n\n\n### Computing the Average Marginal Effects\n\nTo compute the AMEs in R, [you can leverage the `margins` package](https://cran.r-project.org/web/packages/margins/vignettes/Introduction.html):\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#install.packages(\"margins\")\nlibrary(margins)\n\name <- margins(model_high_risk, variables = \"drug_use\")\nsummary(ame)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n   factor     AME     SE       z      p   lower   upper\n drug_use -0.1556 0.0291 -5.3429 0.0000 -0.2127 -0.0985\n```\n:::\n:::\n\n\n\nThis will give you the average marginal effect of drug use on the probability of a heart attack across all ages in the dataset.\n\n### Interpreting the AMEs\n\nSuppose the AME for drug use is -0.156. This means that, on average, across all ages in our sample, using the drug is associated with a 15.6 percentage point decrease in the probability of experiencing a heart attack relative to not using the drug.\n\nThis single number provides an overarching sense of the drug's impact, making it immensely useful for policy and clinical decisions. For instance, in public health discussions or in communications with patients, being able to state the average effect of a treatment can be more practical than specifying its impact at particular ages or conditions.\n\nBy incorporating AMEs into your analysis, youâ€™re providing an extra layer of depth to your findings. This approach shifts the discussion from \"what might the effect be?\" to \"here's the effect, on average, across our population.\" When combined with specific marginal effects and predicted probabilities, this trio offers a robust, comprehensive, and intuitive understanding of your predictors' impacts.\n\n## Visualizing Predicted Probabilities\n\nTo provide a tangible representation, let's plot the predicted probabilities of heart attacks by age from our model:\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(ggplot2)\n\ndata_high_risk$predicted_prob <- predict(model_high_risk, type = \"response\")\npredictions <- predict(model_high_risk, type = \"response\", se.fit = TRUE)\ndata_high_risk$lower_ci <- predictions$fit - 1.96 * predictions$se.fit\ndata_high_risk$upper_ci <- predictions$fit + 1.96 * predictions$se.fit\n\n\nggplot(data_high_risk, aes(x = age, \n                           y = predicted_prob, \n                           color = as.factor(drug_use))) +\n  geom_ribbon(aes(ymin = lower_ci, \n                  ymax = upper_ci, \n                  fill = as.factor(drug_use)), alpha = 0.3) +\n  geom_line() +\n  labs(title = \"Predicted Probability of Heart Attack by Age with 95% CI\",\n       y = \"Predicted Probability\",\n       x = \"Age\",\n       color = \"Drug Use\",\n       fill = \"Drug Use\") +\n  scale_color_discrete(labels = c(\"No Drug\", \"On Drug\")) +\n  scale_fill_discrete(labels = c(\"No Drug\", \"On Drug\")) +\n  theme_minimal()\n```\n\n::: {.cell-output-display}\n![](2023-09-01-OR_files/figure-html/unnamed-chunk-8-1.png){width=672}\n:::\n:::\n\n\nThe visual clearly illustrates the beneficial effect of the drug over time. It gives a tangible sense of how the risk of heart attacks evolves with age for both groups and the significant advantage of drug users. This can be especially useful for diagnostic purposes or to demonstrate the results of your model to stakeholders.\n\n\n## Conclusion: A Call to Transition\n\nThe era of odds ratios has provided us with valuable insights, but as the field of health research progresses, so should our statistical tools and reporting practices. Marginal effects and predicted probabilities provide clearer, more intuitive insights, pushing us away from the ambiguous realm of odds and into the tangible world of real impact.\n\nAfter all, the end goal of our research is to provide clear, actionable insights that can be readily applied to improve health outcomes. Let's choose clarity over tradition, and marginal effects over odds ratios.\n\nThank you!\n\nJacob\n",
    "supporting": [
      "2023-09-01-OR_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<script src=\"../../site_libs/kePrint/kePrint.js\"></script>\n<link href=\"../../site_libs/lightable/lightable.css\" rel=\"stylesheet\" />\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}